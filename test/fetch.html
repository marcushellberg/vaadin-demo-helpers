<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-fetch-demo-data-mixin tests</title>

  <script src="../../../wct-browser-legacy/browser.js"></script>
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
</head>

<body>

  <dom-module id="x-loader">
    <template>
      <style>
        :host {
          display: block;
        }
      </style>
      <slot></slot>
    </template>
  </dom-module>

  <script type="module">
    import { FetchDemoDataMixin } from '../vaadin-fetch-demo-data-mixin.js';
    import { PolymerElement } from '@polymer/polymer/polymer-element.js';
    class XLoader extends FetchDemoDataMixin(PolymerElement) {
      static get is() {
        return 'x-loader';
      }
    }
    customElements.define(XLoader.is, XLoader);
  </script>

  <test-fixture id="default">
    <template>
      <x-loader></x-loader>
    </template>
  </test-fixture>

  <script type="module">
    import '../vaadin-fetch-demo-data-mixin.js';
    import '@polymer/polymer/polymer-element.js';

    describe('basic functionality', () => {
      let element;

      beforeEach(() => {
        element = fixture('default');
      });

      describe('fetch resources', () => {

        it('should load the .js file', done => {
          element.fetchResource('x-bar.js')
            .then(e => {
              expect(e.type).to.eql('load');
              expect(window.customElements.get('x-bar')).to.be.ok;
              done();
            });
        });

        it('should reject loading the not-existing .js file', done => {
          element.fetchResource('x-foo.js')
            .catch(e => {
              expect(e.type).to.eql('error');
              done();
            });
        });
      });

      describe('fetch JSON', () => {
        it('should load the .json file', done => {
          element.fetchJSON('x-test.json')
            .then(result => {
              expect(result).to.be.an.object;
              expect(result.data).to.be.an.array;
              expect(result.data.length).to.eql(2);
              done();
            });
        });

        it('should reject loading the not-existing .json file', done => {
          element.fetchJSON('x-missing.json')
            .catch(e => {
              expect(e.target.status).to.eql(404);
              done();
            });
        });

      });
    });
</script>
</body>
